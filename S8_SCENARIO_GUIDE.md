# S8决策军师场景 - 使用指南

## 🎯 场景概述

S8决策军师是展示"企业大脑+主动式"能力的核心场景，通过**会议助手+主动修正**的方式，演示AI如何实时感知公司发生的事，自动更新决策建议。

---

## ✨ 核心亮点

1. **时间轴演示**：v1.0早晨版本 → 会议录入 → v2.0自动修正
2. **主动修正**：不是"勾选才用"，而是"感知新信息就更新"
3. **对比视图**：左右分屏，直观看到哪里变了、为什么变
4. **来源证明**：每个建议都能追溯到会议原文或数据来源
5. **冲突检测**（方案B）：自动检测决策矛盾，提示选择

---

## 🎬 演示流程（60-90秒）

### **第一幕：生成初版晨报（v1.0）** - 20秒

1. 打开S8决策军师页面
2. 点击"生成晨报 (v1.0)"
3. **观察**：系统基于经营数据生成3条建议
   ```
   ✓ 建议1: 增加广告投放预算
   ✓ 建议2: 优化官网落地页
   ✓ 建议3: 尝试拓展新渠道如B站
   ```
4. **说明**：这些是通用建议，因为此时系统还不知道公司今天的会议决议

---

### **第二幕：现场录入会议记录** - 20秒

1. 在右侧"会议助手"面板，点击"示例"按钮加载示例会议记录：
   ```
   市场部10月29日紧急会议纪要

   会议要点：
   1. Q4营销策略调整：明确主推三大产品线
   2. 重点渠道调整为小红书和抖音
   3. 小红书转化率从3.5%降至2.8%
   4. 立即行动：加强内容差异化
   ```

2. 点击"提交会议记录"

3. **观察进度**：
   ```
   ✓ 正在提取关键信息...
   ✓ 识别到战略决策 3条
   ✓ 识别到数据异常 1条
   ✓ 写入企业记忆库...完成
   ```

4. **等待通知**：
   ```
   🔔 检测到新的会议记录，您的晨报已自动更新！
   ```

---

### **第三幕：查看对比与修正原因** - 30秒

1. 点击"确定"查看对比

2. **观察对比视图**：

   | v1.0 早晨版本 | v2.0 修正版本 |
   |--------------|--------------|
   | ❌ 增加广告投放预算 | ✅ 优化小红书内容策略，聚焦三大产品线 |
   | ❌ 优化官网落地页 | ✅ 调整抖音投放定向，降低获客成本 |
   | ❌ 拓展新渠道如B站 | ✅ 加强内容团队培训，解决同质化问题 |

3. 点击"为什么修正？"查看修正原因：
   ```
   修正原因

   📍 检测到您在 10:00 录入了"市场部紧急会议"记录，
   我发现了3个关键信息与早晨建议相关：

   1. 会议明确了Q4战略方向：三大产品线 + 小红书/抖音
      → 我早晨的建议"拓展B站"与此决议不一致

   2. 会议披露了数据异常：小红书转化率降21%
      → 这是比"增加预算"更紧迫的问题

   3. 会议已有明确决议：李经理负责内容优化
      → 我应该给出具体的支持行动
   ```

4. **关键演示话术**：
   > "大家看，决策军师不是被动等你'勾选记忆'，而是**主动感知**公司发生的事，**自动修正**自己的建议。现在所有建议都完全对齐市场部会议的战略方向。这才是真正的企业大脑——它在持续学习，实时同步公司共识。"

---

### **第四幕：确认并指派行动** - 10秒

1. 点击"确认并指派行动"
2. 修改责任人和截止期（可选）
3. 选择"确认（模拟同步）"或"确认并同步看板"
4. **观察结果**：
   ```
   ✓ 已生成3个任务
   ✓ 已生成 3 个任务，模拟同步到飞书看板

   任务列表：
   - TASK_20251029_101520: 优化小红书内容策略...
   - TASK_20251029_101521: 调整抖音投放定向...
   - TASK_20251029_101522: 加强内容团队培训...
   ```

---

## 🔧 技术实现说明

### **后端核心模块**

1. **事件总线** (`backend/app/core/event_bus.py`)
   - 订阅发布模式
   - 支持异步事件分发

2. **会议助手Agent** (`backend/app/core/meeting_assistant.py`)
   - 提取结构化信息（LLM）
   - 写入记忆库
   - 触发 `MEMORY_UPDATED` 事件

3. **S8决策军师Agent** (`backend/app/scenarios/s8_decision.py`)
   - 4个节点：汇总 → 风险 → 建议 → 确认
   - 订阅 `MEMORY_UPDATED` 事件
   - 主动修正逻辑：检测新记忆 → 重新生成 → 推送通知

4. **API路由** (`backend/app/api/s8_decision.py`)
   - `/api/s8/generate` - 生成报告
   - `/api/s8/meeting/process` - 处理会议记录
   - `/api/s8/actions/confirm` - 确认行动
   - `/api/s8/ws` - WebSocket实时通知

### **前端核心组件**

1. **S8Decision页面** (`frontend/src/pages/S8Decision.jsx`)
   - WebSocket监听报告更新
   - 对比视图展示
   - 会议助手面板

2. **关键交互流程**：
   ```
   用户点击生成
   → POST /api/s8/generate
   → 返回v1.0报告

   用户提交会议记录
   → POST /api/s8/meeting/process
   → 后端触发事件
   → WebSocket推送 "report_updated"
   → 前端弹出通知
   → 用户确认后加载v2.0
   ```

---

## 🎨 前端UI说明

### **页面布局（3:2:1）**

```
┌────────────────────────────────────┬──────────────┐
│  决策军师主界面 (66%)              │ 会议助手 (33%)│
│                                    │              │
│  [生成晨报] [确认并指派行动]       │ 会议记录输入 │
│                                    │              │
│  ┌──────────────────────────────┐ │ [提交] [示例] │
│  │ 版本: v1.0 | 生成时间: ...  │ │              │
│  └──────────────────────────────┘ │ 提示：       │
│                                    │ • 自动提取   │
│  经营摘要                          │ • 写入记忆   │
│  异常与风险                        │ • 触发更新   │
│  三项优先行动                      │              │
│                                    │              │
└────────────────────────────────────┴──────────────┘
```

### **对比视图布局**

```
┌────────────────────────────────────────────────────┐
│ 🔔 报告已自动更新                                  │
│ 基于新的会议记录，已更新建议                       │
└────────────────────────────────────────────────────┘

┌─────────────────────────┬─────────────────────────┐
│ v1.0 早晨版本 (灰色)    │ v2.0 修正版本 (高亮)     │
│                         │                         │
│ • 建议1 (通用)          │ • 建议1 (对齐会议)      │
│ • 建议2                 │ • 建议2                 │
│ • 建议3                 │ • 建议3                 │
└─────────────────────────┴─────────────────────────┘

┌────────────────────────────────────────────────────┐
│ 为什么修正？                                       │
│ • 原因1: ...                                      │
│ • 原因2: ...                                      │
│ • 原因3: ...                                      │
└────────────────────────────────────────────────────┘
```

---

## 📝 演示脚本（逐字稿）

### **开场（10秒）**
> "现在演示S8决策军师场景，这是最能体现'企业大脑'价值的场景。假设现在是早上7:30，CEO打开系统查看今日晨报..."

### **生成v1.0（10秒）**
> "系统给出了3条建议：增加预算、优化落地页、拓展B站。这些建议没错，但比较通用，因为此时系统还不知道公司今天的会议决议。"

### **录入会议（20秒）**
> "现在假设是上午10点，市场部刚开完紧急会议。我现场演示会议助手如何处理...
>
> （点击"示例"→"提交"）
>
> 看，会议助手正在提取关键信息...识别到3条战略决策、1条数据异常...写入企业记忆库...完成。
>
> （弹出通知）
>
> 系统检测到新的会议记录，正在重新分析晨报..."

### **查看对比（30秒）**
> "大家看对比！
>
> 左边是v1.0早晨版本，右边是v2.0修正版本。
>
> 所有建议都变了：
> - '拓展B站' → '优化小红书'（对齐会议决议：重点小红书）
> - '增加预算' → '调整抖音定向'（对齐会议决议：重点抖音）
> - '优化落地页' → '加强培训'（对齐会议提到的内容同质化问题）
>
> 点开'为什么修正'...看，系统解释了每条修正的原因，都能追溯到会议原文。
>
> **这才是企业大脑**：不是被动等你勾选记忆，而是主动感知公司发生的事，自动修正决策。"

### **确认行动（10秒）**
> "现在CEO可以确认这些建议，指派责任人...点击确认...系统立即生成3个任务编号，并同步到看板。
>
> 从点击'生成晨报'到确认任务，总共60秒。"

---

## 🚀 快速启动

### **1. 后端启动**

```bash
cd backend

# 安装依赖（首次）
pip install -r requirements.txt

# 配置API Key
# 编辑 .env 文件，填入 OPENAI_API_KEY

# 启动后端
python -m uvicorn app.main:app --reload
```

### **2. 前端启动**

```bash
cd frontend

# 安装依赖（首次）
npm install

# 启动前端
npm run dev
```

### **3. 访问页面**

- 前端：http://localhost:5173
- 后端API文档：http://localhost:8000/docs
- 直达S8页面：http://localhost:5173/s8-decision

---

## 🔍 调试技巧

### **查看后端日志**

后端终端会显示详细日志：
```
📊 开始生成CEO决策军师晨报 (v1.0)...
  [节点1] 汇总助手...
    ✓ 汇总完成: 4 个关键指标
  [节点2] 异常/风险助手...
    ✓ 识别到 2 个风险
  [节点3] 策略建议助手...
    ✓ 生成 3 项建议

📝 会议助手开始处理会议记录...
✅ 已写入 3 条记忆
🔔 检测到记忆更新事件，正在分析是否需要修正报告...
  → 需要修正报告: 会议明确了战略方向
  ✓ 报告已更新并推送通知
```

### **查看WebSocket消息**

浏览器Console会显示：
```
WebSocket连接成功
收到WebSocket消息: {type: "report_updated", data: {...}}
报告已更新: {...}
```

### **测试API**

访问 http://localhost:8000/docs 测试各个接口：
- `POST /api/s8/generate` - 生成报告
- `POST /api/s8/meeting/process` - 处理会议记录
- `GET /api/s8/report/current` - 获取当前报告

---

## ⚠️ 常见问题

### **Q1: 点击生成晨报后报错**
**A**: 检查是否配置了 `OPENAI_API_KEY`，并且有足够的额度。

### **Q2: 提交会议记录后没有触发更新**
**A**: 检查后端日志，确认：
1. 会议助手成功提取了信息
2. 触发了 `MEMORY_UPDATED` 事件
3. S8 Agent订阅了该事件

### **Q3: WebSocket连接失败**
**A**: 确保后端WebSocket路径正确：`ws://localhost:8000/api/s8/ws`

### **Q4: 对比视图不显示**
**A**: 检查是否：
1. 先生成了v1.0报告
2. 提交了会议记录后点击了"确定"查看对比

---

## 📊 性能优化

- LLM调用温度设置：汇总0.5、风险0.6、建议0.7、判断0.3
- 记忆召回数量：每个节点最多5条
- WebSocket心跳：前端每30秒发送ping

---

## 🎉 演示成功标准

1. ✅ v1.0报告在20秒内生成
2. ✅ 会议记录在10秒内处理完成
3. ✅ WebSocket通知正常弹出
4. ✅ v2.0建议与会议内容对齐
5. ✅ 对比视图清晰展示差异
6. ✅ 修正原因逻辑清晰
7. ✅ 任务确认流程流畅

---

**祝演示成功！** 🎊
